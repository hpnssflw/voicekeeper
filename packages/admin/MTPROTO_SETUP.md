# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MTProto –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –ø–æ—Å—Ç–∏–Ω–≥–∞ –≤ –∫–∞–Ω–∞–ª—ã

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

MTProto —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ **–æ—Ç–¥–µ–ª—å–Ω—ã–π Node.js —Å–µ—Ä–≤–∏—Å** (`packages/bot`), –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —Ç–∞–∫ –∫–∞–∫:
- Next.js API routes —Ä–∞–±–æ—Ç–∞—é—Ç –≤ serverless –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- MTProto —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –°–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

**Admin** (`packages/admin`) –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ **Bot** —Å–µ—Ä–≤–∏—Å—É —á–µ—Ä–µ–∑ HTTP.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Telegram API Credentials** - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å `api_id` –∏ `api_hash` –Ω–∞ https://my.telegram.org/apps
2. **Bot —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 4000 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–æ–∑–¥–∞–π—Ç–µ `infra/.env`:

```env
# MTProto (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
TELEGRAM_API_ID=your_api_id
TELEGRAM_API_HASH=your_api_hash

# Database
MONGO_URI=mongodb://mongodb:27017/app
REDIS_URL=redis://redis:6379

# NextAuth
NEXTAUTH_URL=http://localhost:3001
NEXTAUTH_SECRET=your_secret_here
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

#### Bot —Å–µ—Ä–≤–∏—Å (`packages/bot/.env` –∏–ª–∏ `.env.local`):

```env
TELEGRAM_API_ID=your_api_id
TELEGRAM_API_HASH=your_api_hash
MONGO_URI=your_mongo_uri
```

–ì–¥–µ `your_api_id` –∏ `your_api_hash` - —ç—Ç–æ –∫—Ä–µ–¥—ã –∏–∑ —Å—Ç—Ä–æ–∫ 19-20 –≤–∞—à–µ–≥–æ `.env.local` —Ñ–∞–π–ª–∞.

#### Admin (`packages/admin/.env.local`):

```env
NEXT_PUBLIC_API_BASE=http://localhost:4000/api
```

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —É–∫–∞–∂–∏—Ç–µ URL –≤–∞—à–µ–≥–æ bot —Å–µ—Ä–≤–∏—Å–∞.

## –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) üê≥

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± - –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –≤ Docker:

```bash
cd infra
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª —Å TELEGRAM_API_ID –∏ TELEGRAM_API_HASH
docker-compose up -d
```

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: [MTPROTO_DOCKER.md](./MTPROTO_DOCKER.md)

### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

#### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Bot —Å–µ—Ä–≤–∏—Å (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):

```bash
cd packages/bot
npm install
npm run dev
```

–°–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –Ω–∞ `http://localhost:4000`

#### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Admin:

```bash
cd packages/admin
npm install
npm run dev
```

Admin –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ `http://localhost:3001` –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å MTProto –∑–∞–ø—Ä–æ—Å—ã –∫ bot —Å–µ—Ä–≤–∏—Å—É.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram

1. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Bot —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—â–µ–Ω** –Ω–∞ `http://localhost:4000`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤" (`/dashboard/channels`)
3. –ù–∞–∂–º–∏—Ç–µ "–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è" –≤ –∫–∞—Ä—Ç–æ—á–∫–µ MTProto —Å—Ç–∞—Ç—É—Å–∞
4. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –ø–æ–ª—É—á–∏—Ç–µ –∫–æ–¥
5. **–ö–æ–¥ –ø—Ä–∏–¥–µ—Ç –≤ –≤–∏–¥–µ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram** –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –≥–¥–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —ç—Ç–æ—Ç –Ω–æ–º–µ—Ä
6. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram
7. –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è 2FA, –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å

### 2. –ü–∞—Ä—Å–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤

1. –î–æ–±–∞–≤—å—Ç–µ –∫–∞–Ω–∞–ª —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª"
2. –ù–∞–∂–º–∏—Ç–µ "–ü–∞—Ä—Å–∏—Ç—å" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–∞
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∫–∞–Ω–∞–ª–∞

### 3. –ü–æ—Å—Ç–∏–Ω–≥ –≤ –∫–∞–Ω–∞–ª—ã

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ MTProto
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ –∫–∞–Ω–∞–ª–µ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ—Å—Ç–∏–Ω–≥–∞
3. –ù–∞–∂–º–∏—Ç–µ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å" –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –∫–∞–Ω–∞–ª–∞
4. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
5. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤–∫–ª—é—á–∏—Ç–µ "–¢–∏—Ö–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞" –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
6. –ù–∞–∂–º–∏—Ç–µ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å"

## API Endpoints

–í—Å–µ API endpoints –≤ `packages/admin/app/api/mtproto/` **–ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç –∑–∞–ø—Ä–æ—Å—ã** –∫ bot —Å–µ—Ä–≤–∏—Å—É:

- `GET /api/mtproto/status` ‚Üí `GET http://localhost:4000/api/mtproto/status`
- `GET /api/mtproto/session?ownerId=xxx` ‚Üí `GET http://localhost:4000/api/mtproto/session?ownerId=xxx`
- `POST /api/mtproto/auth/start` ‚Üí `POST http://localhost:4000/api/mtproto/auth/start`
- `POST /api/mtproto/auth/complete` ‚Üí `POST http://localhost:4000/api/mtproto/auth/complete`
- `POST /api/mtproto/auth/logout` ‚Üí `POST http://localhost:4000/api/mtproto/auth/logout`
- `POST /api/mtproto/channels/info` ‚Üí `POST http://localhost:4000/api/mtproto/channels/info`
- `POST /api/mtproto/channels/parse` ‚Üí `POST http://localhost:4000/api/mtproto/channels/parse`
- `POST /api/mtproto/channels/post` ‚Üí `POST http://localhost:4000/api/mtproto/channels/post`
- `GET /api/mtproto/channels?ownerId=xxx` ‚Üí `GET http://localhost:4000/api/mtproto/channels?ownerId=xxx`
- `GET /api/mtproto/posts?ownerId=xxx&channelId=xxx` ‚Üí `GET http://localhost:4000/api/mtproto/posts?ownerId=xxx&channelId=xxx`

**–†–µ–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ bot —Å–µ—Ä–≤–∏—Å–µ** (`packages/bot/src/routes/mtproto.routes.ts`).

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

–ú–æ–¥–µ–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `packages/bot/src/models/`:
- `TelegramSession` - —Ö—Ä–∞–Ω–∏—Ç —Å–µ—Å—Å–∏–∏ MTProto –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `ParsedChannel` - —Ö—Ä–∞–Ω–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã—Ö –∫–∞–Ω–∞–ª–∞—Ö
- `ParsedPost` - —Ö—Ä–∞–Ω–∏—Ç —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã –∏–∑ –∫–∞–Ω–∞–ª–æ–≤

**–í–∞–∂–Ω–æ**: –í—Å–µ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –∏ —Ç—É –∂–µ MongoDB –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: 
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–π –ª–∏—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç Telegram –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ù–µ –¥–µ–ª–∏—Ç–µ—Å—å —Å–µ—Å—Å–∏–µ–π —Å –¥—Ä—É–≥–∏–º–∏
- –•—Ä–∞–Ω–∏—Ç–µ `TELEGRAM_API_ID` –∏ `TELEGRAM_API_HASH` –≤ —Å–µ–∫—Ä–µ—Ç–µ
- –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —à–∏—Ñ—Ä–æ–≤–∞—Ç—å `sessionString` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

